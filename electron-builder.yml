# =============================================================================
# Electron Builder Configuration
# =============================================================================
#
# This file configures electron-builder for packaging the application.
# Architecture is specified via CLI flags (--x64 or --arm64) to allow
# separate workflow jobs per architecture without upload collisions.
#
# Targets:
#   - macOS: DMG + ZIP (x64, arm64 via CLI)
#   - Windows: NSIS installer + Portable (x64)
#   - Linux: AppImage, DEB, RPM, tar.gz (x64)
#
# =============================================================================

appId: com.benwendell.gemini-desktop
productName: Gemini Desktop
directories:
  output: release
  buildResources: build

files:
  - dist-electron/**/*
  - dist/**/*
  - package.json

# Exclude unnecessary files from the package
extraFiles:
  - from: build
    to: resources
    filter:
      - "*.png"

# Windows Configuration
win:
  target:
    - target: nsis
      arch:
        - x64
    - target: portable
      arch:
        - x64
  icon: build/icon.png
  artifactName: ${productName}-${version}-${arch}.${ext}

# Portable gets a different name to avoid collision with NSIS installer
portable:
  artifactName: ${productName}-${version}-${arch}-portable.${ext}

nsis:
  oneClick: false
  allowToChangeInstallationDirectory: true
  deleteAppDataOnUninstall: true
  createDesktopShortcut: true
  createStartMenuShortcut: true
  perMachine: false
  artifactName: ${productName}-${version}-${arch}-installer.${ext}

# macOS Configuration
# Note: Architecture is specified via CLI flags (--x64 or --arm64)
# This allows separate jobs to build each architecture without conflicts
mac:
  target:
    - dmg
    - zip
  icon: build/icon.png
  # Skip code signing when no certificates are configured
  identity: null
  # Uncomment when you have signing certificates:
  # hardenedRuntime: true
  # gatekeeperAssess: false
  # entitlements: build/entitlements.mac.plist
  # entitlementsInherit: build/entitlements.mac.plist
  artifactName: ${productName}-${version}-${arch}.${ext}

dmg:
  sign: false
  writeUpdateInfo: false

# Linux Configuration
linux:
  target:
    - target: AppImage
      arch:
        - x64
    - target: deb
      arch:
        - x64
    - target: rpm
      arch:
        - x64
    - target: tar.gz
      arch:
        - x64
  icon: build/icon.png
  category: Utility
  artifactName: ${productName}-${version}-${arch}.${ext}

deb:
  depends:
    - gconf2
    - gconf-service
    - libnotify4
    - libappindicator1
    - libxtst6
    - libnss3
    - libasound2

rpm:
  depends:
    - libnotify
    - libappindicator
    - libXtst
    - nss
    - alsa-lib

publish:
  provider: github
  releaseType: draft
  # Increase timeout to 10 minutes (600000ms) to prevent upload timeouts
  # Default is ~60 seconds which is too short for large Windows installers
  timeout: 600000
